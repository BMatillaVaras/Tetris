"use strict";const grid=document.querySelector(".grid");let squares=Array.from(document.querySelectorAll(".grid div"));const scoreDisplay=document.querySelector("#score"),startBtn=document.querySelector("#start-button"),width=10;let timerId,nextRandom=0,score=0;const colors=["darkBlue","orange","red","green","pink","purple","lightBlue"],lTetromino=[[1,11,21,2],[10,11,12,22],[1,11,21,20],[10,20,21,22]],uTetromino=[[0,1,11,21],[2,10,11,12],[1,11,21,22],[10,11,12,20]],zTetromino=[[11,12,20,21],[0,10,11,21],[11,12,20,21],[0,10,11,21]],sTetromino=[[10,11,21,22],[2,11,12,21],[10,11,21,22],[2,11,12,21]],tTetromino=[[1,10,11,12],[1,11,12,21],[10,11,12,21],[1,10,11,21]],oTetromino=[[0,1,10,11],[0,1,10,11],[0,1,10,11],[0,1,10,11]],iTetromino=[[10,11,12,13],[1,11,21,31],[10,11,12,13],[1,11,21,31]],theTetrominoes=[lTetromino,uTetromino,zTetromino,sTetromino,tTetromino,oTetromino,iTetromino];let currentPosition=4,currentRotation=0,random=Math.floor(Math.random()*theTetrominoes.length),current=theTetrominoes[random][0];function draw(){current.forEach(e=>{squares[currentPosition+e].classList.add("tetromino"),squares[currentPosition+e].style.backgroundColor=colors[random]})}function undraw(){current.forEach(e=>{squares[currentPosition+e].classList.remove("tetromino"),squares[currentPosition+e].style.backgroundColor=""})}function control(e){37===e.keyCode?moveLeft():38===e.keyCode?rotate():39===e.keyCode?moveRight():40===e.keyCode&&moveDown()}function moveDown(){undraw(),currentPosition+=10,draw(),freeze()}function freeze(){current.some(e=>squares[currentPosition+e+10].classList.contains("taken"))&&(current.forEach(e=>squares[currentPosition+e].classList.add("taken")),random=nextRandom,nextRandom=Math.floor(Math.random()*theTetrominoes.length),current=theTetrominoes[random][currentRotation],currentPosition=4,draw(),displayShape(),addScore(),gameOver())}function moveLeft(){undraw();current.some(e=>(currentPosition+e)%10==0)||(currentPosition-=1),current.some(e=>squares[currentPosition+e].classList.contains("taken"))&&(currentPosition+=1),draw()}function moveRight(){undraw();current.some(e=>(currentPosition+e)%10==9)||(currentPosition+=1),current.some(e=>squares[currentPosition+e].classList.contains("taken"))&&(currentPosition-=1),draw()}function rotate(){undraw(),currentRotation++,currentRotation===current.length&&(currentRotation=0),current=theTetrominoes[random][currentRotation]}document.addEventListener("keyup",control);const displaySquares=document.querySelectorAll(".mini-grid div"),displayWidth=4;let displayIndex=0;const upNextTetrominoes=[[1,5,9,2],[0,1,5,9],[5,6,8,9],[4,5,9,10],[1,4,5,6],[0,1,4,5],[4,5,6,7]];function displayShape(){displaySquares.forEach(e=>{e.classList.remove("tetromino"),e.style.backgroundColor=""}),upNextTetrominoes[nextRandom].forEach(e=>{displaySquares[displayIndex+e].classList.add("tetromino"),displaySquares[displayIndex+e].style.backgroundColor=colors[nextRandom]})}function startPause(){timerId?(clearInterval(timerId),timerId=null):(draw(),timerId=setInterval(moveDown,1e3),nextRandom=Math.floor(Math.random()*theTetrominoes.length),displayShape())}function addScore(){for(let e=0;e<199;e+=10){const t=[e,e+1,e+2,e+3,e+4,e+5,e+6,e+7,e+8,e+9];if(t.every(e=>squares[e].classList.contains("taken"))){score+=10,scoreDisplay.innerHTML=score,t.forEach(e=>{squares[e].classList.remove("taken"),squares[e].classList.remove("tetromino"),squares[e].style.backgroundColor=""});const o=squares.splice(e,10);squares=o.concat(squares),squares.forEach(e=>grid.appendChild(e))}}}function gameOver(){current.some(e=>squares[currentPosition+e].classList.contains("taken"))&&(scoreDisplay.innerHTML="end",clearInterval(timerId))}startBtn.addEventListener("click",startPause);